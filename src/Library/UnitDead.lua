---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 23.01.2020 20:11
function InitUnitDeath()
	local gg_trg_DEADGUI = CreateTrigger()
	TriggerRegisterAnyUnitEventBJ(gg_trg_DEADGUI, EVENT_PLAYER_UNIT_DEATH)
	TriggerAddAction(gg_trg_DEADGUI, function()
		local DeadUnit=GetTriggerUnit()
		local killer=GetKillingUnit()
		local data = HERO[GetPlayerId(GetOwningPlayer(killer))]
		if GetUnitTypeId(killer)==FourCC('nsko') then
			killer=data.UnitHero
		end
		if IsUnitType(DeadUnit,UNIT_TYPE_HERO) then --герой умер
			if CustomFrameSystem then
				CreateCallingBar(DeadUnit,10,"Воскрешение")
			end
			local PD=GetOwningPlayer(DeadUnit)
			TimerStart(CreateTimer(), 10, false, function()
				ReviveHero(DeadUnit,GetPlayerStartLocationX(PD),GetPlayerStartLocationY(PD),true)
				SelectUnitForPlayerSingle(DeadUnit,PD)
				SetCameraPosition(GetPlayerStartLocationX(PD),GetPlayerStartLocationY(PD))
			end)
		end

		if IsUnitType(killer,UNIT_TYPE_HERO) and data.HasHat then --герой убил и создаёт зомба
			if BlzGetUnitAbilityCooldownRemaining(killer,SpellIDS)<=.01 and not IsUnitType(DeadUnit,UNIT_TYPE_MECHANICAL) and IsUnitRace(DeadUnit,RACE_ORC) then
				BlzStartUnitAbilityCooldown(killer,SpellIDS,10)
				ArgBonus(data,SpellIDS,10)
				--print("Время создать зомби")
				TimerStart(CreateTimer(), 1, false, function()
					ShowUnit(DeadUnit,false)
					DestroyEffectHD(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton",GetUnitXY(DeadUnit)))
					local new=CreateUnit(GetOwningPlayer(killer),FourCC('nsko'),GetUnitX(DeadUnit),GetUnitY(DeadUnit),GetRandomInt(0,360))
					BlzSetUnitBaseDamage(new,data.bonusCD,0)
					UnitApplyTimedLife(new,FourCC('BTLF'),30)
					IssueTargetOrder(new,"patrol",killer)
					TimerStart(CreateTimer(), 1, true, function()
						local x,y=GetUnitXY(killer)
						local distance=DistanceBetweenXY(x,y,GetUnitXY(new))
						if distance>600 then
							IssuePointOrder(new,"move", x,y)
						else
							if GetUnitCurrentOrder(new)~=String2OrderIdBJ("attack") then
								local rx,ry=x+GetRandomInt(-500,500),y+GetRandomInt(-500,500)
								IssuePointOrder(new,"attack", rx,ry)
							end
						end
						if not UnitAlive(new) then
							DestroyTimer(GetExpiredTimer())
						end
					end)
				end)
			end
		end
	end)
end